


ARM Macro Assembler    Page 1 


    1 00000000         ;
    2 00000000         ;    Proyecto Hardware
    3 00000000         ;    Práctica 1
    4 00000000         ;
    5 00000000         ;    Fichero: conecta4_hay_linea_arm_arm_opt3.s
    6 00000000         ;
    7 00000000         ;    Autores:
    8 00000000         ;        Dorian Boleslaw Wozniak   (817570@unizar.es)
    9 00000000         ;        Pablo Latre Villacampa    (778543@unizar.es)
   10 00000000         ;
   11 00000000         ;    Descripción: Implementación de la función hay_linea
                        en código ensamblador
   12 00000000         ;     con llamada a buscar_alineamiento_arm_opt2. Además
                       , omite
   13 00000000         ;     llamar a buscar_alineamiento sobre la ficha dada a
                       l ser
   14 00000000         ;     ya del mismo color, por lo que la línea tendrá tam
                       año
   15 00000000         ;     mínimo 1
   16 00000000         
   17 00000000                 AREA             datos, DATA
   18 00000000         
   19 00000000 00000006 
                       NUM_FILAS
                               EQU              6
   20 00000000 00000007 
                       NUM_COLUMNAS
                               EQU              7
   21 00000000 00000001 
                       PADDING_FIL
                               EQU              1
   22 00000000 00000001 
                       PADDING_COL
                               EQU              1
   23 00000000 00000007 
                       TAM_FILS
                               EQU              NUM_FILAS + PADDING_FIL
   24 00000000 00000008 
                       TAM_COLS
                               EQU              NUM_COLUMNAS + PADDING_COL
   25 00000000         
   26 00000000 00000004 
                       CELDA_VACIA
                               EQU              0x04
   27 00000000 00000003 
                       CELDA_COLOR
                               EQU              0x03
   28 00000000         
   29 00000000 00000000 
                       FALSE   EQU              0
   30 00000000 00000001 
                       TRUE    EQU              1
   31 00000000         
   32 00000000 00 FF FF 
              01       deltas_fila
                               DCB              0, -1, -1, 1
   33 00000004 FF 00 FF 
              FF       deltas_columna
                               DCB              -1, 0, -1, -1



ARM Macro Assembler    Page 2 


   34 00000008         
   35 00000008         
   36 00000008                 AREA             codigo, CODE
   37 00000000         
   38 00000000                 IMPORT           conecta4_buscar_alineamiento_ar
m_opt2
   39 00000000                 PRESERVE8        {TRUE}
   40 00000000         
   41 00000000                 EXPORT           conecta4_hay_linea_arm_arm_opt3
   42 00000000         
   43 00000000         ;   Entrada:
   44 00000000         ;       r0 -> @cuadricula
   45 00000000         ;       r1 -> fila
   46 00000000         ;       r2 -> columna
   47 00000000         ;       r3 -> color
   48 00000000         ;
   49 00000000         ;   Salida
   50 00000000         ;       r0 <- >= 1 si hay linea, 0 si no hay linea
   51 00000000         ;
   52 00000000         ;   Descripción:
   53 00000000         ;  Devuelve verdad si ha encontrado una línea de celdas 
                       del mismo color al
   54 00000000         ;  dado de 4 celdas o más. En caso contrario, devueve fa
                       lso.
   55 00000000         conecta4_hay_linea_arm_arm_opt3
   56 00000000         ; Prologo
   57 00000000 E1A0C00D        mov              r12, r13
   58 00000004 E92DDFF0        stmdb            r13!, { r4 - r10, r11, r12, r14
, r15 }
   59 00000008 E24CB004        sub              r11, r12, #4
   60 0000000C         
   61 0000000C         ;   Bloque de activación:
   62 0000000C         ;
   63 0000000C         ;   SP  -> | r4 - r10          | hay_linea
   64 0000000C         ;          | FP anterior    |
   65 0000000C         ;          | SP anterior       |
   66 0000000C         ;          | LR anterior       |
   67 0000000C         ;   FP -> | PC anterior    |
   68 0000000C         ;          | ----------------- |
   69 0000000C         ;          |              | C4_verificar_4_en_linea
   70 0000000C         
   71 0000000C         ; Mueve parametros a registros variables
   72 0000000C E1A04000        mov              r4, r0      ; r4 = @cuadricula
   73 00000010 E1A05001        mov              r5, r1      ; r5 = fila
   74 00000014 E1A06002        mov              r6, r2      ; r6 = columna
   75 00000018 E1A07003        mov              r7, r3      ; r7 = color
   76 0000001C         
   77 0000001C         ; Inicializa variables del bucle
   78 0000001C E3A08000        mov              r8, #0      ; i              
   79 00000020         
   80 00000020         ; for()
   81 00000020 E3A09001 
                       hl_for  mov              r9, #1      ; long_linea
   82 00000024         
   83 00000024         ;   i < 4
   84 00000024 E3580004        cmp              r8, #4
   85 00000028 A3A00000        movge            r0, #FALSE
   86 0000002C AA00001C        bge              hl_return
   87 00000030         



ARM Macro Assembler    Page 3 


   88 00000030         ;   Obtiene deltas[i]
   89 00000030 E59F0070        LDR              r0, =deltas_fila
   90 00000034 E19000D8        ldrsb            r0, [r0, r8]
   91 00000038 E59F306C        LDR              r3, =deltas_columna
   92 0000003C E19330D8        ldrsb            r3, [r3, r8]
   93 00000040         
   94 00000040         ;   Prepara primera llamada a buscar_alineamiento
   95 00000040 E0851000        add              r1, r5, r0
   96 00000044 E0862003        add              r2, r6, r3
   97 00000048 E92D0009        stmdb            r13!, {r0, r3}
   98 0000004C E1A00004        mov              r0, r4
   99 00000050 E1A03007        mov              r3, r7
  100 00000054         
  101 00000054 EBFFFFFE        bl               conecta4_buscar_alineamiento_ar
m_opt2
  102 00000058         
  103 00000058         ;   long_linea >= 4
  104 00000058 E0809009        add              r9, r0, r9
  105 0000005C E3590004        cmp              r9, #4
  106 00000060 A3A00001        movge            r0, #TRUE
  107 00000064 AA00000E        bge              hl_return
  108 00000068         
  109 00000068         ;   Recupera y niega deltas
  110 00000068 E8BD0009        ldmia            r13!, { r0, r3 }
  111 0000006C E2600000        rsb              r0, r0, #0
  112 00000070 E2633000        rsb              r3, r3, #0
  113 00000074         
  114 00000074         ;   Prepara segunda llamada a buscar_alineamiento
  115 00000074 E0851000        add              r1, r5, r0
  116 00000078 E0862003        add              r2, r6, r3
  117 0000007C E92D0009        stmdb            r13!, {r0, r3}
  118 00000080 E1A00004        mov              r0, r4
  119 00000084 E1A03007        mov              r3, r7
  120 00000088         
  121 00000088 EBFFFFFE        bl               conecta4_buscar_alineamiento_ar
m_opt2
  122 0000008C         
  123 0000008C         ;   long_linea >= 4
  124 0000008C E0899000        add              r9, r9, r0
  125 00000090 E3590004        cmp              r9, #4
  126 00000094 A3A00001        movge            r0, #TRUE
  127 00000098 AA000001        bge              hl_return
  128 0000009C         
  129 0000009C         ;   i++
  130 0000009C E2888001        add              r8, r8, #1
  131 000000A0 EAFFFFDE        b                hl_for
  132 000000A4         
  133 000000A4 E91BAFF0 
                       hl_return
                               ldmdb            r11, { r4 - r10, r11, r13, r15 
}
  134 000000A8         
  135 000000A8                 END
              00000000 
              00000000 
Command Line: --debug --xref --diag_suppress=9931 --apcs=interwork --depend=.\o
bjects\conecta4_hay_linea_arm_arm_opt3.d -o.\objects\conecta4_hay_linea_arm_arm
_opt3.o -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_v5\A
RM\INC\Philips --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION SETA 



ARM Macro Assembler    Page 4 


526" --list=.\listings\conecta4_hay_linea_arm_arm_opt3.lst conecta4_hay_linea_a
rm_arm_opt3.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

datos 00000000

Symbol: datos
   Definitions
      At line 17 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      None
Comment: datos unused
deltas_columna 00000004

Symbol: deltas_columna
   Definitions
      At line 33 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 91 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: deltas_columna used once
deltas_fila 00000000

Symbol: deltas_fila
   Definitions
      At line 32 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 89 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: deltas_fila used once
3 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

codigo 00000000

Symbol: codigo
   Definitions
      At line 36 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      None
Comment: codigo unused
conecta4_hay_linea_arm_arm_opt3 00000000

Symbol: conecta4_hay_linea_arm_arm_opt3
   Definitions
      At line 55 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 41 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: conecta4_hay_linea_arm_arm_opt3 used once
hl_for 00000020

Symbol: hl_for
   Definitions
      At line 81 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 131 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: hl_for used once
hl_return 000000A4

Symbol: hl_return
   Definitions
      At line 133 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 86 in file conecta4_hay_linea_arm_arm_opt3.s
      At line 107 in file conecta4_hay_linea_arm_arm_opt3.s
      At line 127 in file conecta4_hay_linea_arm_arm_opt3.s

4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

CELDA_COLOR 00000003

Symbol: CELDA_COLOR
   Definitions
      At line 27 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      None
Comment: CELDA_COLOR unused
CELDA_VACIA 00000004

Symbol: CELDA_VACIA
   Definitions
      At line 26 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      None
Comment: CELDA_VACIA unused
FALSE 00000000

Symbol: FALSE
   Definitions
      At line 29 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 85 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: FALSE used once
NUM_COLUMNAS 00000007

Symbol: NUM_COLUMNAS
   Definitions
      At line 20 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 24 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: NUM_COLUMNAS used once
NUM_FILAS 00000006

Symbol: NUM_FILAS
   Definitions
      At line 19 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 23 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: NUM_FILAS used once
PADDING_COL 00000001

Symbol: PADDING_COL
   Definitions
      At line 22 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 24 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: PADDING_COL used once
PADDING_FIL 00000001

Symbol: PADDING_FIL
   Definitions
      At line 21 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 23 in file conecta4_hay_linea_arm_arm_opt3.s
Comment: PADDING_FIL used once
TAM_COLS 00000008

Symbol: TAM_COLS



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 24 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      None
Comment: TAM_COLS unused
TAM_FILS 00000007

Symbol: TAM_FILS
   Definitions
      At line 23 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      None
Comment: TAM_FILS unused
TRUE 00000001

Symbol: TRUE
   Definitions
      At line 30 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 106 in file conecta4_hay_linea_arm_arm_opt3.s
      At line 126 in file conecta4_hay_linea_arm_arm_opt3.s

10 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

conecta4_buscar_alineamiento_arm_opt2 00000000

Symbol: conecta4_buscar_alineamiento_arm_opt2
   Definitions
      At line 38 in file conecta4_hay_linea_arm_arm_opt3.s
   Uses
      At line 101 in file conecta4_hay_linea_arm_arm_opt3.s
      At line 121 in file conecta4_hay_linea_arm_arm_opt3.s

1 symbol
352 symbols in table
