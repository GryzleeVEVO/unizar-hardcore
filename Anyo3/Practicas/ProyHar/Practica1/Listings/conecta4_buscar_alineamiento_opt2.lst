


ARM Macro Assembler    Page 1 


    1 00000000         ;
    2 00000000         ;    Proyecto Hardware
    3 00000000         ;    Práctica 1
    4 00000000         ;
    5 00000000         ;    Fichero: conecta4_buscar_alineamiento_arm_opt2.s
    6 00000000         ;
    7 00000000         ;    Autores:
    8 00000000         ;        Dorian Boleslaw Wozniak   (817570@unizar.es)
    9 00000000         ;        Pablo Latre Villacampa    (778543@unizar.es)
   10 00000000         ;
   11 00000000         ;    Descripción: Implementación de la función buscar_al
                       ineamiento en código ensamblador
   12 00000000         ;     sustituyendo el algoritmo recursivo por uno iterat
                       ivo. Tambien
   13 00000000         ;     hace un mejor uso de los registros
   14 00000000         
   15 00000000                 AREA             datos, DATA
   16 00000000         
   17 00000000 00000006 
                       NUM_FILAS
                               EQU              6
   18 00000000 00000007 
                       NUM_COLUMNAS
                               EQU              7
   19 00000000 00000001 
                       PADDING_FIL
                               EQU              1
   20 00000000 00000001 
                       PADDING_COL
                               EQU              1
   21 00000000 00000007 
                       TAM_FILS
                               EQU              NUM_FILAS + PADDING_FIL
   22 00000000 00000008 
                       TAM_COLS
                               EQU              NUM_COLUMNAS + PADDING_COL
   23 00000000         
   24 00000000 00000004 
                       CELDA_VACIA
                               EQU              0x04
   25 00000000 00000003 
                       CELDA_COLOR
                               EQU              0x03
   26 00000000         
   27 00000000 00000000 
                       FALSE   EQU              0
   28 00000000 00000001 
                       TRUE    EQU              1
   29 00000000         
   30 00000000                 AREA             codigo, CODE
   31 00000000         
   32 00000000                 EXPORT           conecta4_buscar_alineamiento_ar
m_opt2
   33 00000000         
   34 00000000         ;   Entrada:
   35 00000000         ;       r0 -> @cuadricula
   36 00000000         ;       r1 -> fila
   37 00000000         ;       r2 -> columna
   38 00000000         ;       r3 -> color



ARM Macro Assembler    Page 2 


   39 00000000         ;       r11 + 4 -> *deltas_fila[i]
   40 00000000         ;       r11 + 8 -> *deltas_columna[i]
   41 00000000         ;
   42 00000000         ;   Salida:
   43 00000000         ;       r0 <- longuitud linea
   44 00000000         ;
   45 00000000         ;   Descripción:
   46 00000000         ;       Devuelve el número de celdas del mismo color con
                       secutivas en
   47 00000000         ;       la línea recta dada por delta_fila y delta_colum
                       na a partir de 
   48 00000000         ;       cuadricula[fila][columna]
   49 00000000         
   50 00000000         conecta4_buscar_alineamiento_arm_opt2
   51 00000000         ; Prologo
   52 00000000 E1A0C00D        mov              r12, r13
   53 00000004 E92DDFF0        stmdb            r13!, { r4 - r10, r11, r12, r14
, r15 }
   54 00000008 E24CB004        sub              r11, r12, #4
   55 0000000C         
   56 0000000C         ;   Bloque de activación:
   57 0000000C         ;
   58 0000000C         ;   SP  -> | r4 - r10          | buscar_alineamiento
   59 0000000C         ;          | FP anterior    |
   60 0000000C         ;          | SP anterior       |
   61 0000000C         ;          | LR anterior       |
   62 0000000C         ;   FP -> | PC anterior    |
   63 0000000C         ;          | ----------------- |
   64 0000000C         ;          | delta_fila[i]     | hay_linea
   65 0000000C         ;          | delta_columna[i]  |
   66 0000000C         
   67 0000000C         ; Mueve parametros a registros variables
   68 0000000C E1A04000        mov              r4, r0      ; r4 = @cuadricula
   69 00000010         
   70 00000010 E28B7004        add              r7, r11, #0x04 ; Calcula @ base
                                                             de parametros
   71 00000014 E8970060        ldmia            r7, { r5 - r6 } ; r5, r6 = delt
                                                            a_columna, delta_fi
                                                            la
   72 00000018         
   73 00000018 E3A00000        mov              r0 , #0     ; i = num lineas en
                                                            contradas
   74 0000001C         
   75 0000001C         ; r0 = lineas
   76 0000001C         ; r1 = fila
   77 0000001C         ; r2 = columna
   78 0000001C         ; r3 = color
   79 0000001C         ; r4 = @cuadricula
   80 0000001C         ; r5 = delta_fila
   81 0000001C         ; r6 = delta_columna
   82 0000001C         ; r7 = *cuadricula[fila][columna]
   83 0000001C         ; r8 = celda & val
   84 0000001C         
   85 0000001C         ; while
   86 0000001C         ;   !C4_fila_valida(fila) (! 1 <= fila <= NUM_FILAS)
   87 0000001C E3510001 
                       ba_while
                               cmp              r1, #1
   88 00000020 BA000011        blt              ba_return



ARM Macro Assembler    Page 3 


   89 00000024 E3510006        cmp              r1, #NUM_FILAS
   90 00000028 CA00000F        bgt              ba_return
   91 0000002C         
   92 0000002C         ;   !C4_columna_valida(columna)) (! 1 <= columna <= NUM_
                       COLUMNAS)
   93 0000002C E3520001        cmp              r2, #1
   94 00000030 BA00000D        blt              ba_return
   95 00000034 E3520007        cmp              r2, #NUM_COLUMNAS
   96 00000038 CA00000B        bgt              ba_return
   97 0000003C         
   98 0000003C         ;   Obtiene valor de celda en cuadricula[fila][columna]
   99 0000003C E0847181        add              r7, r4, r1, lsl #3 ; r10 = @cua
                                                            dricula[fila][0] (@
                                                            cuad + 8 * filas)
  100 00000040 E7D77002        ldrb             r7, [r7, r2] ; r10 = *cuadricul
                                                            a[fila][columna]
  101 00000044         
  102 00000044         ;   celda_vacia(cuadricula[fila][columna]) (celda & 0x04
                        == 0)
  103 00000044 E2078004        and              r8, r7, #CELDA_VACIA
  104 00000048 E3580000        cmp              r8, #0
  105 0000004C 0A000006        beq              ba_return
  106 00000050         
  107 00000050         ;   celda_color(cuadricula[fila][columna] != ) (celda & 
                       0x03 != color)
  108 00000050 E2078003        and              r8, r7, #CELDA_COLOR
  109 00000054 E1580003        cmp              r8, r3
  110 00000058 1A000003        bne              ba_return
  111 0000005C         
  112 0000005C         ;  Actualiza índices
  113 0000005C E0811005        add              r1, r1, r5
  114 00000060 E0822006        add              r2, r2, r6
  115 00000064         
  116 00000064         ; Suma 1 al resultado
  117 00000064 E2800001        add              r0, r0 , #1
  118 00000068         
  119 00000068 EAFFFFEB        b                ba_while
  120 0000006C         
  121 0000006C E91BAFF0 
                       ba_return
                               ldmdb            r11, { r4 - r10, r11, r13, r15 
}
  122 00000070         
  123 00000070                 END
Command Line: --debug --xref --diag_suppress=9931 --apcs=interwork --depend=.\o
bjects\conecta4_buscar_alineamiento_opt2.d -o.\objects\conecta4_buscar_alineami
ento_opt2.o -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_
v5\ARM\INC\Philips --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION S
ETA 526" --list=.\listings\conecta4_buscar_alineamiento_opt2.lst conecta4_busca
r_alineamiento_opt2.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

datos 00000000

Symbol: datos
   Definitions
      At line 15 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      None
Comment: datos unused
1 symbol



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

ba_return 0000006C

Symbol: ba_return
   Definitions
      At line 121 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 88 in file conecta4_buscar_alineamiento_opt2.s
      At line 90 in file conecta4_buscar_alineamiento_opt2.s
      At line 94 in file conecta4_buscar_alineamiento_opt2.s
      At line 96 in file conecta4_buscar_alineamiento_opt2.s
      At line 105 in file conecta4_buscar_alineamiento_opt2.s
      At line 110 in file conecta4_buscar_alineamiento_opt2.s

ba_while 0000001C

Symbol: ba_while
   Definitions
      At line 87 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 119 in file conecta4_buscar_alineamiento_opt2.s
Comment: ba_while used once
codigo 00000000

Symbol: codigo
   Definitions
      At line 30 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      None
Comment: codigo unused
conecta4_buscar_alineamiento_arm_opt2 00000000

Symbol: conecta4_buscar_alineamiento_arm_opt2
   Definitions
      At line 50 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 32 in file conecta4_buscar_alineamiento_opt2.s
Comment: conecta4_buscar_alineamiento_arm_opt2 used once
4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

CELDA_COLOR 00000003

Symbol: CELDA_COLOR
   Definitions
      At line 25 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 108 in file conecta4_buscar_alineamiento_opt2.s
Comment: CELDA_COLOR used once
CELDA_VACIA 00000004

Symbol: CELDA_VACIA
   Definitions
      At line 24 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 103 in file conecta4_buscar_alineamiento_opt2.s
Comment: CELDA_VACIA used once
FALSE 00000000

Symbol: FALSE
   Definitions
      At line 27 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      None
Comment: FALSE unused
NUM_COLUMNAS 00000007

Symbol: NUM_COLUMNAS
   Definitions
      At line 18 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 22 in file conecta4_buscar_alineamiento_opt2.s
      At line 95 in file conecta4_buscar_alineamiento_opt2.s

NUM_FILAS 00000006

Symbol: NUM_FILAS
   Definitions
      At line 17 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 21 in file conecta4_buscar_alineamiento_opt2.s
      At line 89 in file conecta4_buscar_alineamiento_opt2.s

PADDING_COL 00000001

Symbol: PADDING_COL
   Definitions
      At line 20 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 22 in file conecta4_buscar_alineamiento_opt2.s
Comment: PADDING_COL used once
PADDING_FIL 00000001

Symbol: PADDING_FIL
   Definitions
      At line 19 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      At line 21 in file conecta4_buscar_alineamiento_opt2.s
Comment: PADDING_FIL used once
TAM_COLS 00000008



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols


Symbol: TAM_COLS
   Definitions
      At line 22 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      None
Comment: TAM_COLS unused
TAM_FILS 00000007

Symbol: TAM_FILS
   Definitions
      At line 21 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      None
Comment: TAM_FILS unused
TRUE 00000001

Symbol: TRUE
   Definitions
      At line 28 in file conecta4_buscar_alineamiento_opt2.s
   Uses
      None
Comment: TRUE unused
10 symbols
347 symbols in table
